---
// Google Analytics 4 Component
// Добавляет аналитику на все страницы
// Замените G-XXXXXXXXXX на ваш Measurement ID

const GA_MEASUREMENT_ID = import.meta.env.PUBLIC_GA_MEASUREMENT_ID || 'G-XXXXXXXXXX';
---

<!-- Google Analytics 4 -->
{GA_MEASUREMENT_ID !== 'G-XXXXXXXXXX' && (
	<>
		<script
			async
			src={`https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`}
		></script>
		<script is:inline define:vars={{ gaId: GA_MEASUREMENT_ID }}>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag('js', new Date());
			gtag('config', gaId, {
				anonymize_ip: true,
				cookie_flags: 'SameSite=None;Secure',
			});

			// Отслеживание кликов по ссылкам
			document.addEventListener('click', (e) => {
				const link = e.target.closest('a');
				if (link && link.href) {
					gtag('event', 'click', {
						event_category: 'link',
						event_label: link.href,
						event_value: 1,
						transport_type: 'beacon',
					});
				}
			});

			// Отслеживание времени на странице
			let startTime = Date.now();
			window.addEventListener('beforeunload', () => {
				const timeOnPage = Math.round((Date.now() - startTime) / 1000);
				if (timeOnPage > 0) {
					gtag('event', 'time_on_page', {
						event_category: 'engagement',
						event_label: window.location.pathname,
						value: timeOnPage,
						transport_type: 'beacon',
					});
				}
			});

			// Отслеживание скролла (25%, 50%, 75%, 100%)
			let scrollTracked = { 25: false, 50: false, 75: false, 100: false };
			window.addEventListener('scroll', () => {
				const scrollPercent = Math.round(
					((window.scrollY + window.innerHeight) / document.documentElement.scrollHeight) *
						100
				);
				[25, 50, 75, 100].forEach((threshold) => {
					if (scrollPercent >= threshold && !scrollTracked[threshold]) {
						scrollTracked[threshold] = true;
						gtag('event', 'scroll', {
							event_category: 'engagement',
							event_label: `${threshold}%`,
							value: threshold,
						});
					}
				});
			});
		</script>
	</>
)}










