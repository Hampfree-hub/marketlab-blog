---
import { SITE_TITLE } from '../consts';
import HeaderLink from './HeaderLink.astro';

// BASE_URL уже содержит '/marketlab-academy', добавляем '/' перед logo.svg
const baseUrl = import.meta.env.BASE_URL.endsWith('/') 
	? import.meta.env.BASE_URL 
	: import.meta.env.BASE_URL + '/';
const logoPath = `${baseUrl}logo.svg?v=5`;
---

<header>
	<nav>
		<h2><a href="/" class="logo-link">
			<img src={logoPath} alt="MarketLab Academy" class="logo-img" />
		</a></h2>
		<div class="internal-links">
			<HeaderLink href="/blog">Блог</HeaderLink>
			<HeaderLink href="/about">О проекте</HeaderLink>
		</div>
		<div class="header-right">
			<div class="language-switcher">
				<button class="lang-button active" aria-label="Русский">RU</button>
				<button class="lang-button" aria-label="English">EN</button>
				<button class="lang-button" aria-label="Español">ES</button>
			</div>
			<div class="social-links">
				<a href="https://dzen.ru/hampfree_algo_trading" target="_blank" rel="noopener noreferrer" class="social-button" data-label="Дзен">
					<span class="social-tooltip">Дзен</span>
				</a>
				<a href="https://vk.com/hampfree_market_lab" target="_blank" rel="noopener noreferrer" class="social-button" data-label="VK">
					<span class="social-tooltip">VK</span>
				</a>
				<a href="https://finbazar.ru/profile/Hampfree" target="_blank" rel="noopener noreferrer" class="social-button" data-label="Bazar">
					<span class="social-tooltip">Bazar</span>
				</a>
			</div>
		</div>
	</nav>
</header>

<style>
	header {
		margin: 0;
		padding: 0 1em;
		background: var(--bg-primary);
		box-shadow: var(--box-shadow);
		transition: background-color 0.3s ease, box-shadow 0.3s ease;
	}
	h2 {
		margin: 0;
		font-size: 1em;
	}

	.logo-link {
		text-decoration: none;
		display: flex;
		align-items: center;
	}

	.logo-img {
		width: 40px;
		height: 40px;
		min-width: 40px;
		min-height: 40px;
		border: none !important;
		border-radius: 0;
		outline: none !important;
		box-shadow: none !important;
		transition: transform 0.2s ease, filter 0.2s ease;
		display: block;
		object-fit: contain;
		flex-shrink: 0;
		background: transparent;
	}
	
	.logo-link:focus .logo-img,
	.logo-img:focus {
		outline: none !important;
		box-shadow: none !important;
		border: none !important;
	}

	.logo-link:hover .logo-img {
		transform: scale(1.05);
		filter: brightness(1.1);
	}
	
	nav {
		display: flex;
		align-items: center; /* Выравнивание по центру по вертикали */
		justify-content: space-between;
		gap: 1.5em;
		flex-wrap: wrap;
	}
	nav a {
		padding: 1em 0.5em;
		color: var(--text-primary);
		border-bottom: 4px solid transparent;
		text-decoration: none;
		transition: color 0.2s ease, border-color 0.2s ease;
	}
	
	nav a:hover {
		color: var(--accent);
	}
	
	nav a.active {
		text-decoration: none;
		border-bottom-color: var(--accent);
		color: var(--accent);
	}

	.internal-links {
		display: flex;
		align-items: center;
		gap: 0.5em;
		flex-wrap: wrap;
		flex: 1;
		min-width: 0;
	}

	/* Dropdown меню */
	.dropdown {
		position: relative;
	}

	.dropdown-button {
		display: flex;
		align-items: center;
		gap: 0.25em;
		padding: 1em 0.5em;
		background: transparent;
		border: none;
		color: var(--text-primary);
		cursor: pointer;
		font-size: 1em;
		font-family: 'Lato', sans-serif;
		transition: color 0.2s ease;
	}

	.dropdown-button:hover {
		color: var(--accent);
	}

	.dropdown-button svg {
		transition: transform 0.2s ease;
	}

	.dropdown:hover .dropdown-button svg,
	.dropdown-button[aria-expanded="true"] ~ .dropdown-menu svg {
		transform: rotate(180deg);
	}

	.dropdown-menu {
		position: absolute;
		top: 100%;
		left: 0;
		background: var(--bg-primary);
		border-radius: 8px;
		box-shadow: 
			0 4px 12px rgba(0, 0, 0, 0.15),
			0 8px 24px rgba(0, 0, 0, 0.2);
		min-width: 180px;
		opacity: 0;
		visibility: hidden;
		transform: translateY(-10px);
		transition: all 0.2s ease;
		z-index: 100;
		margin-top: 0.5em;
	}

	/* Показывать меню при hover (desktop) */
	.dropdown:hover .dropdown-menu {
		opacity: 1;
		visibility: visible;
		transform: translateY(0);
	}

	/* Показывать меню при focus (accessibility и touch devices) */
	.dropdown:focus-within .dropdown-menu {
		opacity: 1;
		visibility: visible;
		transform: translateY(0);
	}

	/* На touch devices показывать при tap на кнопку */
	.dropdown-button:focus ~ .dropdown-menu {
		opacity: 1;
		visibility: visible;
		transform: translateY(0);
	}

	.dropdown-menu a {
		display: block;
		padding: 0.75em 1em;
		color: var(--text-primary);
		text-decoration: none;
		border-bottom: 1px solid var(--bg-secondary);
		transition: all 0.2s ease;
		transform: translateY(0);
	}

	/* Скругление углов для первого элемента */
	.dropdown-menu a:first-child {
		border-top-left-radius: 8px;
		border-top-right-radius: 8px;
	}

	/* Скругление углов для последнего элемента */
	.dropdown-menu a:last-child {
		border-bottom: none;
		border-bottom-left-radius: 8px;
		border-bottom-right-radius: 8px;
	}

	.dropdown-menu a:hover {
		background: var(--bg-secondary);
		color: var(--accent);
		border-bottom-color: transparent;
	}

	.header-right {
		display: flex;
		align-items: center;
		gap: 0.75em;
		flex-shrink: 0;
	}

	.language-switcher {
		display: flex;
		gap: 0;
		background: transparent;
		border-radius: 4px;
		padding: 0;
	}

	.lang-button {
		padding: 0.25em 0.5em;
		background: transparent;
		border: none;
		border-radius: 0;
		color: var(--text-secondary);
		font-size: 0.75em;
		font-weight: 400;
		cursor: pointer;
		transition: color 0.2s ease;
		font-family: 'Lato', sans-serif;
		position: relative;
	}

	.lang-button:not(:last-child)::after {
		content: '';
		position: absolute;
		right: 0;
		top: 50%;
		transform: translateY(-50%);
		width: 1px;
		height: 60%;
		background: rgba(122, 122, 122, 0.2);
	}

	.lang-button:hover {
		color: var(--accent);
	}

	.lang-button.active {
		color: var(--accent);
		font-weight: 600;
	}

	.social-links {
		display: flex;
		gap: 0.75em;
		align-items: center;
	}
	
	.social-button {
		width: 24px;
		height: 24px;
		min-width: 24px;
		min-height: 24px;
		max-width: 24px;
		max-height: 24px;
		aspect-ratio: 1;
		border-radius: 6px;
		display: block;
		position: relative;
		transition: all 0.3s ease;
		backdrop-filter: blur(10px);
		-webkit-backdrop-filter: blur(10px);
		text-decoration: none;
		flex-shrink: 0;
		box-sizing: border-box;
		padding: 0;
		margin: 0;
	}
	
	/* Минималистичные квадратные пузырьки без символов */
	.social-button[href*="dzen"] {
		background: rgba(0, 0, 0, 0.4);
		border: 1px solid rgba(255, 255, 255, 0.1);
	}
	
	.social-button[href*="vk"] {
		background: rgba(70, 128, 194, 0.4);
		border: 1px solid rgba(70, 128, 194, 0.3);
	}
	
	.social-button[href*="finbazar"] {
		background: rgba(152, 251, 152, 0.4);
		border: 1px solid rgba(152, 251, 152, 0.3);
	}
	
	/* Тёмная тема */
	@media (prefers-color-scheme: dark) {
		.social-button[href*="dzen"] {
			background: rgba(255, 255, 255, 0.15);
			border: 1px solid rgba(255, 255, 255, 0.2);
		}
		
		.social-button[href*="vk"] {
			background: rgba(70, 128, 194, 0.5);
			border: 1px solid rgba(70, 128, 194, 0.4);
		}
		
		.social-button[href*="finbazar"] {
			background: rgba(152, 251, 152, 0.5);
			border: 1px solid rgba(152, 251, 152, 0.4);
		}
	}
	
	/* Подпись при наведении */
	.social-tooltip {
		position: absolute;
		top: 100%;
		left: 50%;
		transform: translateX(-50%) translateY(8px);
		background: var(--bg-primary);
		color: var(--text-primary);
		padding: 0.35em 0.6em;
		border-radius: 6px;
		font-size: 0.7em;
		white-space: nowrap;
		opacity: 0;
		visibility: hidden;
		transition: all 0.2s ease;
		pointer-events: none;
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
		z-index: 1000;
	}
	
	.social-tooltip::before {
		content: '';
		position: absolute;
		bottom: 100%;
		left: 50%;
		transform: translateX(-50%);
		border: 4px solid transparent;
		border-bottom-color: var(--bg-primary);
	}
	
	.social-button:hover .social-tooltip {
		opacity: 1;
		visibility: visible;
		transform: translateX(-50%) translateY(4px);
	}
	
	/* Hover эффект - меняется интенсивность цвета */
	.social-button[href*="dzen"]:hover {
		background: rgba(0, 0, 0, 0.7);
		transform: scale(1.05);
	}
	
	.social-button[href*="vk"]:hover {
		background: rgba(70, 128, 194, 0.7);
		transform: scale(1.05);
	}
	
	.social-button[href*="finbazar"]:hover {
		background: rgba(152, 251, 152, 0.7);
		transform: scale(1.05);
	}

	.sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border-width: 0;
	}
	
	/* Промежуточные экраны (таблет) */
	@media (max-width: 1024px) {
		nav {
			gap: 1em;
		}
		
		.internal-links {
			gap: 0.4em;
		}
		
		nav a, .dropdown-button {
			padding: 0.875em 0.5em;
			font-size: 0.95em;
		}
		
		.header-right {
			gap: 0.75em;
		}
	}

	/* Промежуточный размер: элементы внутри вертикально, но nav остаётся горизонтальным */
	@media (max-width: 900px) {
		header {
			padding: 0 1em;
		}
		
		/* nav остаётся горизонтальным, просто уменьшаем gap */
		nav {
			gap: 1em;
		}
		
		.logo-img {
			width: 36px;
			height: 36px;
			min-width: 36px;
			min-height: 36px;
		}
		
		/* Навигация - просто меньше размеры */
		.internal-links {
			gap: 0.4em;
		}
		
		nav a, .dropdown-button {
			padding: 0.875em 0.5em;
			font-size: 0.95em;
		}
		
		.header-right {
			gap: 0.75em;
		}

		.lang-button {
			padding: 0.25em 0.4em;
			font-size: 0.7em;
		}
		
		.social-button {
			width: 22px;
			height: 22px;
			min-width: 22px;
			min-height: 22px;
			max-width: 22px;
			max-height: 22px;
		}
	}
	
	/* Очень узкие экраны - тогда только вертикализация */
	@media (max-width: 600px) {
		/* nav становится вертикальным (все элементы лесенкой) */
		nav {
			flex-direction: column;
			align-items: flex-start;
			gap: 1em;
		}
		
		.logo-link {
			margin-bottom: 0.5em;
		}
		
		/* Навигация вертикально (лесенкой) */
		.internal-links {
			flex-direction: column;
			align-items: flex-start;
			width: 100%;
			gap: 0.5em;
		}
		
		nav a, .dropdown-button {
			width: 100%;
			text-align: left;
			padding: 0.75em 0;
		}
		
		/* Языки и соцсети - вертикально друг за другом */
		.header-right {
			flex-direction: column;
			align-items: flex-start;
			width: 100%;
			gap: 0.75em;
		}

		.language-switcher {
			flex-direction: column;
			width: 100%;
			gap: 0.5em;
		}
		
		.lang-button {
			width: 100%;
			text-align: left;
			padding: 0.5em 0.75em;
		}
		
		.lang-button:not(:last-child)::after {
			display: none;
		}
		
		/* Соцсети вертикально */
		.social-links {
			flex-direction: column;
			width: 100%;
			gap: 0.5em;
		}
		
		.social-button {
			align-self: flex-start;
		}
	}
		
		/* На мобильных: показываем меню при focus на кнопке (tap) */
		.dropdown-button:focus ~ .dropdown-menu,
		.dropdown:focus-within .dropdown-menu {
			opacity: 1;
			visibility: visible;
			transform: translateY(0);
		}
		
		/* Делаем кнопку кликабельной на touch devices */
		.dropdown-button {
			display: flex;
			touch-action: manipulation;
		}
		
		.header-right {
			display: flex;
		}
	}
	
	/* Очень узкие экраны */
	@media (max-width: 480px) {
		header {
			padding: 0 0.75em;
		}
		
		nav {
			gap: 0.5em;
		}
		
		.internal-links {
			gap: 0.4em;
		}
		
		nav a, .dropdown-button {
			padding: 0.65em 0;
			font-size: 0.9em;
		}
		
		.logo-img {
			width: 32px;
			height: 32px;
			min-width: 32px;
			min-height: 32px;
			border: none !important;
			outline: none !important;
			box-shadow: none !important;
		}
		
		.header-right {
			gap: 0.5em;
		}
		
		.lang-button {
			padding: 0.4em 0.6em;
		}
		
		.social-links {
			gap: 0.4em;
		}
	}
</style>
