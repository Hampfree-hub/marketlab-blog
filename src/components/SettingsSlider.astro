---
// Выдвигающийся 8-бит слайдер настроек (тема + язык)
---

<div class="settings-slider" aria-label="Настройки" title="Настройки">
	<!-- Единый элемент: стрелка в начале, вытягивается как целое -->
	<div class="settings-container">
		<!-- Стрелочка в начале (всегда справа, прилипает к краю) -->
		<div class="settings-arrow-container">
			<svg class="settings-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
				<path d="M19 12H5M12 19l-7-7 7-7"></path>
			</svg>
		</div>
		
		<!-- Панель с тумблерами (вытягивается вертикально вниз) -->
		<div class="settings-panel">
			<div class="settings-controls">
				<!-- Переключатель темы -->
				<button id="theme-toggle" class="theme-toggle-btn" aria-label="Переключить тему" title="Переключить тему">
					<svg class="theme-icon theme-icon-sun" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<circle cx="12" cy="12" r="5"></circle>
						<line x1="12" y1="1" x2="12" y2="3"></line>
						<line x1="12" y1="21" x2="12" y2="23"></line>
						<line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
						<line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
						<line x1="1" y1="12" x2="3" y2="12"></line>
						<line x1="21" y1="12" x2="23" y2="12"></line>
						<line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
						<line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
					</svg>
					<svg class="theme-icon theme-icon-moon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
					</svg>
				</button>
				
				<!-- Переключатель языков (как кнопка темы - одна кнопка) -->
				<button id="language-toggle" class="language-toggle-btn" aria-label="Переключить язык" title="Переключить язык">
					<span class="lang-text lang-text-ru">RU</span>
					<span class="lang-text lang-text-en">EN</span>
					<span class="lang-text lang-text-es">ES</span>
				</button>
			</div>
		</div>
	</div>
</div>

<script>
	// Theme toggle functionality
	(function() {
		const themeToggle = document.getElementById('theme-toggle');
		const html = document.documentElement;
		
		if (!themeToggle) return;
		
		function getInitialTheme() {
			const saved = localStorage.getItem('theme');
			if (saved === 'dark' || saved === 'light') {
				return saved;
			}
			return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
		}
		
		function setTheme(theme) {
			if (theme === 'dark') {
				html.classList.add('dark-theme');
				html.classList.remove('light-theme');
			} else {
				html.classList.add('light-theme');
				html.classList.remove('dark-theme');
			}
			localStorage.setItem('theme', theme);
			updateIcons();
		}
		
		function updateIcons() {
			if (!themeToggle) return;
			
			const isDark = html.classList.contains('dark-theme');
			const sunIcon = themeToggle.querySelector('.theme-icon-sun');
			const moonIcon = themeToggle.querySelector('.theme-icon-moon');
			
			if (isDark) {
				if (sunIcon) {
					sunIcon.style.opacity = '1';
					sunIcon.style.visibility = 'visible';
					sunIcon.style.display = 'block';
				}
				if (moonIcon) {
					moonIcon.style.opacity = '0';
					moonIcon.style.visibility = 'hidden';
					moonIcon.style.display = 'none';
				}
			} else {
				if (sunIcon) {
					sunIcon.style.opacity = '0';
					sunIcon.style.visibility = 'hidden';
					sunIcon.style.display = 'none';
				}
				if (moonIcon) {
					moonIcon.style.opacity = '1';
					moonIcon.style.visibility = 'visible';
					moonIcon.style.display = 'block';
				}
			}
		}
		
		const currentTheme = getInitialTheme();
		setTheme(currentTheme);
		
		themeToggle.addEventListener('click', () => {
			const isDark = html.classList.contains('dark-theme');
			setTheme(isDark ? 'light' : 'dark');
		});
		
		window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
			if (!localStorage.getItem('theme')) {
				setTheme(e.matches ? 'dark' : 'light');
			}
		});
	})();

	// Language switcher functionality (как кнопка темы - переключение по клику)
	(function() {
		const languageToggle = document.getElementById('language-toggle');
		
		if (!languageToggle) return;
		
		const languages = ['ru', 'en', 'es'];
		
		function getCurrentLanguage() {
			const savedLang = localStorage.getItem('preferred-language');
			if (savedLang && languages.includes(savedLang)) {
				return savedLang;
			}
			const htmlLang = document.documentElement.lang || 'ru';
			return htmlLang.toLowerCase().split('-')[0];
		}
		
		function getNextLanguage(currentLang) {
			const currentIndex = languages.indexOf(currentLang);
			const nextIndex = (currentIndex + 1) % languages.length;
			return languages[nextIndex];
		}
		
		function updateLanguageText(lang) {
			if (!languageToggle) return;
			
			const ruText = languageToggle.querySelector('.lang-text-ru');
			const enText = languageToggle.querySelector('.lang-text-en');
			const esText = languageToggle.querySelector('.lang-text-es');
			
			// Скрываем все
			if (ruText) {
				ruText.style.opacity = '0';
				ruText.style.visibility = 'hidden';
				ruText.style.display = 'none';
			}
			if (enText) {
				enText.style.opacity = '0';
				enText.style.visibility = 'hidden';
				enText.style.display = 'none';
			}
			if (esText) {
				esText.style.opacity = '0';
				esText.style.visibility = 'hidden';
				esText.style.display = 'none';
			}
			
			// Показываем текущий
			if (lang === 'ru' && ruText) {
				ruText.style.opacity = '1';
				ruText.style.visibility = 'visible';
				ruText.style.display = 'block';
			} else if (lang === 'en' && enText) {
				enText.style.opacity = '1';
				enText.style.visibility = 'visible';
				enText.style.display = 'block';
			} else if (lang === 'es' && esText) {
				esText.style.opacity = '1';
				esText.style.visibility = 'visible';
				esText.style.display = 'block';
			}
		}
		
		function switchLanguage(lang) {
			localStorage.setItem('preferred-language', lang);
			document.documentElement.lang = lang;
			updateLanguageText(lang);
			document.querySelectorAll('[data-lang]').forEach(el => {
				const elLang = el.getAttribute('data-lang');
				if (elLang === lang) {
					el.style.display = '';
				} else {
					el.style.display = 'none';
				}
			});
			window.dispatchEvent(new CustomEvent('languageChanged', { detail: { lang } }));
		}
		
		// Инициализация
		const currentLang = getCurrentLanguage();
		switchLanguage(currentLang); // Устанавливаем язык и обновляем текст
		
		languageToggle.addEventListener('click', () => {
			const currentLang = getCurrentLanguage();
			const nextLang = getNextLanguage(currentLang);
			switchLanguage(nextLang);
		});
	})();
</script>

<style>
	.settings-slider {
		position: fixed;
		top: 60px; /* Идеальный центр синей рамки header */
		right: 0; /* Прилипает к краю - скрывает содержимое */
		z-index: 1000;
		font-family: var(--nes-font, 'Press Start 2P', monospace);
		margin: 0; /* Убираем все отступы */
		padding: 0; /* Убираем все отступы */
	}

	/* Единый контейнер: стрелка в начале, вытягивается горизонтально */
	.settings-container {
		position: relative;
		display: flex;
		flex-direction: row; /* Горизонтально! */
		align-items: center;
		width: 20px; /* Минимальная ширина - только стрелка */
		height: 36px;
		transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		cursor: pointer;
		margin: 0; /* Убираем все отступы */
		padding: 0; /* Убираем все отступы */
		outline: none; /* Убираем outline */
	}

	.settings-slider:hover .settings-container {
		width: 100px; /* Вытягивается горизонтально влево */
	}

	/* Контейнер стрелки (всегда справа, в начале) */
	.settings-arrow-container {
		flex-shrink: 0;
		width: 20px;
		height: 36px;
		background: var(--nes-white);
		border: var(--nes-border-width, 2px) solid var(--nes-black);
		border-right: 0; /* Прилипает к краю без разрыва */
		border-top-left-radius: 4px;
		border-bottom-left-radius: 4px;
		display: flex;
		align-items: center;
		justify-content: center;
		/* БЕЗ теней - плоские элементы */
		transition: background 0.2s ease;
		margin: 0; /* Убираем все отступы */
		padding: 0; /* Убираем все отступы */
		outline: none; /* Убираем outline */
	}

	.settings-slider:hover .settings-arrow-container {
		background: var(--nes-yellow);
		border-right: 0; /* Остаётся без правой границы */
	}

	.settings-arrow {
		width: 12px;
		height: 12px;
		transition: transform 0.2s ease;
	}

	.settings-slider:hover .settings-arrow {
		transform: translateY(-1px); /* Небольшое выдвижение вверх (как у кнопок темы и языка) */
	}

	/* Панель с тумблерами (выезжает горизонтально влево) */
	.settings-panel {
		flex: 1;
		height: 36px; /* Та же высота, что и стрелка */
		background: var(--nes-white);
		border: var(--nes-border-width, 2px) solid var(--nes-black);
		border-right: 0; /* Соединяется со стрелкой */
		border-left: var(--nes-border-width, 2px) solid var(--nes-black); /* Левая граница */
		border-top-right-radius: 0; /* Убираем скругление правого края - его изначально не должно быть */
		border-bottom-right-radius: 0; /* Убираем скругление правого края - его изначально не должно быть */
		overflow: hidden; /* Скрываем всё что выходит за границы */
		display: flex;
		align-items: center; /* Вертикальное центрирование */
		justify-content: center; /* Горизонтальное центрирование */
		/* БЕЗ теней - плоские элементы */
		opacity: 0;
		transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		pointer-events: none;
		margin: 0; /* Убираем все отступы */
		padding: 0; /* Убираем все отступы */
		outline: none; /* Убираем outline */
		position: relative;
	}


	.settings-slider:hover .settings-panel {
		opacity: 1;
		pointer-events: all;
	}

	.settings-controls {
		/* Идеальное центрирование: одинаковые отступы со всех сторон */
		/* КРИТИЧНО: Одинаковые расстояния: между жёлтой рамкой и кнопкой = между кнопками = между кнопкой и краем */
		/* КРИТИЧНО: Кнопки должны быть по центру рамки по вертикали */
		padding: 0; /* Убираем padding - используем gap для отступов */
		display: flex;
		flex-direction: row; /* Горизонтально! */
		gap: 6px; /* Отступ между кнопками (равен отступу от краев) */
		align-items: center; /* Вертикальное центрирование - КРИТИЧНО для центрирования кнопок */
		justify-content: center; /* Горизонтальное центрирование */
		width: 100%;
		height: 100%;
		box-sizing: border-box; /* Учитываем padding в размерах */
		margin: 0; /* Убираем все отступы */
		/* КРИТИЧНО: Дополнительное центрирование для идеального выравнивания */
		/* Добавляем отступы от краев через padding на панели */
		padding-left: 6px; /* Отступ слева от жёлтой рамки */
		padding-right: 6px; /* Отступ справа от края */
		padding-top: 0; /* Нет отступа сверху - кнопки по центру */
		padding-bottom: 0; /* Нет отступа снизу - кнопки по центру */
	}

	/* Тумблер темы (вертикальный) */
	.theme-toggle-btn {
		width: 28px;
		height: 28px;
		padding: 0;
		background: var(--nes-white);
		/* Beveling для объёма */
		border-top: var(--nes-border-width, 2px) solid var(--nes-bevel-light, #FFFFFF);
		border-left: var(--nes-border-width, 2px) solid var(--nes-bevel-light, #FFFFFF);
		border-bottom: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-right: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-radius: 4px;
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		position: relative;
		transition: all 0.15s ease;
		color: var(--nes-black);
		flex-shrink: 0;
		margin: 0; /* Убираем все отступы */
	}

	.theme-toggle-btn:hover {
		background: var(--nes-yellow);
		transform: translateY(-1px);
		/* Beveling сохраняется для объёма */
		/* БЕЗ теней - плоские кнопки */
	}

	.theme-toggle-btn:active {
		transform: translateY(1px); /* Кнопка прожимается вниз */
		/* Убираем инвертированный beveling - оставляем все границы тёмными для единообразия */
		border-top: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-left: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-bottom: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-right: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		transition: transform 0.05s ease, border 0.05s ease;
	}

	.theme-icon {
		position: absolute;
		top: 50%;
		left: 50%;
		width: 14px;
		height: 14px;
		pointer-events: none;
		transform: translate(-50%, -50%);
		transition: opacity 0.2s ease, visibility 0.2s ease;
		display: block;
	}

	.theme-icon-sun,
	.theme-icon-moon {
		opacity: 0;
		visibility: hidden;
		display: none;
	}

	/* Показываем правильную иконку в зависимости от темы */
	html.dark-theme .theme-toggle-btn .theme-icon-sun {
		opacity: 1;
		visibility: visible;
		display: block;
	}

	html.light-theme .theme-toggle-btn .theme-icon-moon,
	html:not(.dark-theme):not(.light-theme) .theme-toggle-btn .theme-icon-moon {
		opacity: 1;
		visibility: visible;
		display: block;
	}

	/* Тумблер языков (как кнопка темы - одна кнопка, идентичный стиль) */
	.language-toggle-btn {
		width: 28px;
		height: 28px;
		padding: 0;
		background: var(--nes-white);
		/* Beveling для объёма */
		border-top: var(--nes-border-width, 2px) solid var(--nes-bevel-light, #FFFFFF);
		border-left: var(--nes-border-width, 2px) solid var(--nes-bevel-light, #FFFFFF);
		border-bottom: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-right: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-radius: 4px;
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		position: relative;
		transition: all 0.15s ease;
		color: var(--nes-black);
		flex-shrink: 0;
		margin: 0; /* Убираем все отступы */
		font-family: var(--nes-font, 'Press Start 2P', monospace);
		text-transform: uppercase;
		font-size: 0.4rem;
		font-weight: 400;
	}

	.language-toggle-btn:hover {
		background: var(--nes-yellow);
		transform: translateY(-1px);
		/* Beveling сохраняется для объёма */
	}

	.language-toggle-btn:active {
		transform: translateY(1px); /* Кнопка прожимается вниз */
		/* Убираем инвертированный beveling - оставляем все границы тёмными для единообразия */
		border-top: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-left: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-bottom: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-right: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		transition: transform 0.05s ease, border 0.05s ease;
	}

	.lang-text {
		position: absolute;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		transition: opacity 0.2s ease, visibility 0.2s ease;
		display: block;
		line-height: 1;
	}

	.lang-text-ru,
	.lang-text-en,
	.lang-text-es {
		opacity: 0;
		visibility: hidden;
		display: none;
	}

	/* Мобильная адаптация */
	@media (max-width: 768px) {
		.settings-container {
			width: 18px;
			height: 32px;
		}

		.settings-slider:hover .settings-container {
			width: 90px; /* Горизонтально для мобильных */
		}

		.settings-arrow-container {
			width: 18px;
			height: 32px;
		}

		.settings-arrow {
			width: 10px;
			height: 10px;
		}

		.settings-panel {
			height: 32px;
		}

		.theme-toggle-btn {
			width: 24px;
			height: 24px;
		}

		.language-toggle-btn {
			width: 24px;
			height: 24px;
			font-size: 0.35rem;
		}
	}

	/* ТЁМНАЯ ТЕМА: SettingsSlider */
	html.dark-theme .settings-arrow-container {
		background: var(--nes-bg-card, #1a2a1a);
		border-color: rgba(0, 255, 65, 0.3);
	}

	html.dark-theme .settings-slider:hover .settings-arrow-container {
		background: rgba(0, 255, 65, 0.2);
		border-color: var(--nes-neon-green, #00ff41);
	}

	html.dark-theme .settings-arrow {
		color: var(--nes-neon-green, #00ff41);
	}

	html.dark-theme .settings-panel {
		background: var(--nes-bg-card, #1a2a1a);
		border-color: rgba(0, 255, 65, 0.3);
	}

	html.dark-theme .theme-toggle-btn {
		background: var(--nes-bg-card, #1a2a1a);
		border-color: rgba(0, 255, 65, 0.3);
		color: var(--nes-neon-green, #00ff41);
	}

	html.dark-theme .theme-toggle-btn:hover {
		background: rgba(0, 255, 65, 0.2);
		border-color: var(--nes-neon-green, #00ff41);
	}

	html.dark-theme .theme-toggle-btn:active {
		border-top: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-left: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-bottom: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-right: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
	}

	html.dark-theme .language-toggle-btn {
		background: var(--nes-bg-card, #1a2a1a);
		border-color: rgba(0, 255, 65, 0.3);
		color: var(--nes-neon-green, #00ff41);
	}

	html.dark-theme .language-toggle-btn:hover {
		background: rgba(0, 255, 65, 0.2);
		border-color: var(--nes-neon-green, #00ff41);
	}

	html.dark-theme .language-toggle-btn:active {
		border-top: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-left: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-bottom: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
		border-right: var(--nes-border-width, 2px) solid var(--nes-bevel-dark, #000000);
	}
</style>

