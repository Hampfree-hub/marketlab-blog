---
// Выдвигающийся 8-бит слайдер настроек (тема + язык)
---

<div class="settings-slider">
	<!-- Закладка (tab) в правом верхнем углу -->
	<div class="settings-tab" aria-label="Настройки" title="Настройки">
		<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
			<circle cx="12" cy="12" r="3"></circle>
			<path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"></path>
		</svg>
	</div>
	
	<!-- Выдвигающаяся панель -->
	<div class="settings-panel">
		<div class="settings-controls">
			<!-- Переключатель темы (вертикальный тумблер) -->
			<div class="theme-toggle-wrapper">
				<button id="theme-toggle" class="theme-toggle-btn" aria-label="Переключить тему" title="Переключить тему">
					<svg class="theme-icon theme-icon-sun" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<circle cx="12" cy="12" r="5"></circle>
						<line x1="12" y1="1" x2="12" y2="3"></line>
						<line x1="12" y1="21" x2="12" y2="23"></line>
						<line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
						<line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
						<line x1="1" y1="12" x2="3" y2="12"></line>
						<line x1="21" y1="12" x2="23" y2="12"></line>
						<line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
						<line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
					</svg>
					<svg class="theme-icon theme-icon-moon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
					</svg>
				</button>
			</div>
			
			<!-- Переключатель языков (вертикальный тумблер) -->
			<div class="language-toggle-wrapper">
				<button class="lang-toggle-btn active" data-lang="ru" aria-label="Русский" aria-pressed="true" title="Русский">RU</button>
				<button class="lang-toggle-btn" data-lang="en" aria-label="English" aria-pressed="false" title="English">EN</button>
				<button class="lang-toggle-btn" data-lang="es" aria-label="Español" aria-pressed="false" title="Español">ES</button>
			</div>
		</div>
	</div>
</div>

<script>
	// Theme toggle functionality
	(function() {
		const themeToggle = document.getElementById('theme-toggle');
		const html = document.documentElement;
		
		if (!themeToggle) return;
		
		function getInitialTheme() {
			const saved = localStorage.getItem('theme');
			if (saved === 'dark' || saved === 'light') {
				return saved;
			}
			return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
		}
		
		function setTheme(theme) {
			if (theme === 'dark') {
				html.classList.add('dark-theme');
				html.classList.remove('light-theme');
			} else {
				html.classList.add('light-theme');
				html.classList.remove('dark-theme');
			}
			localStorage.setItem('theme', theme);
			updateIcons();
		}
		
		function updateIcons() {
			if (!themeToggle) return;
			
			const isDark = html.classList.contains('dark-theme');
			const sunIcon = themeToggle.querySelector('.theme-icon-sun');
			const moonIcon = themeToggle.querySelector('.theme-icon-moon');
			
			if (isDark) {
				if (sunIcon) {
					sunIcon.style.opacity = '1';
					sunIcon.style.visibility = 'visible';
					sunIcon.style.display = 'block';
				}
				if (moonIcon) {
					moonIcon.style.opacity = '0';
					moonIcon.style.visibility = 'hidden';
					moonIcon.style.display = 'none';
				}
			} else {
				if (sunIcon) {
					sunIcon.style.opacity = '0';
					sunIcon.style.visibility = 'hidden';
					sunIcon.style.display = 'none';
				}
				if (moonIcon) {
					moonIcon.style.opacity = '1';
					moonIcon.style.visibility = 'visible';
					moonIcon.style.display = 'block';
				}
			}
		}
		
		const currentTheme = getInitialTheme();
		setTheme(currentTheme);
		
		themeToggle.addEventListener('click', () => {
			const isDark = html.classList.contains('dark-theme');
			setTheme(isDark ? 'light' : 'dark');
		});
		
		window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
			if (!localStorage.getItem('theme')) {
				setTheme(e.matches ? 'dark' : 'light');
			}
		});
	})();

	// Language switcher functionality
	(function() {
		function getCurrentLanguage() {
			const htmlLang = document.documentElement.lang || 'ru';
			const savedLang = localStorage.getItem('preferred-language');
			return savedLang || htmlLang.toLowerCase().split('-')[0];
		}

		function updateActiveButton(lang) {
			document.querySelectorAll('.lang-toggle-btn').forEach(button => {
				const buttonLang = button.getAttribute('data-lang');
				if (buttonLang === lang) {
					button.classList.add('active');
					button.setAttribute('aria-pressed', 'true');
				} else {
					button.classList.remove('active');
					button.setAttribute('aria-pressed', 'false');
				}
			});
		}

		function switchLanguage(lang) {
			localStorage.setItem('preferred-language', lang);
			document.documentElement.lang = lang;
			updateActiveButton(lang);
			document.querySelectorAll('[data-lang]').forEach(el => {
				const elLang = el.getAttribute('data-lang');
				if (elLang === lang) {
					el.style.display = '';
				} else {
					el.style.display = 'none';
				}
			});
			window.dispatchEvent(new CustomEvent('languageChanged', { detail: { lang } }));
		}

		document.addEventListener('DOMContentLoaded', () => {
			const currentLang = getCurrentLanguage();
			updateActiveButton(currentLang);
			document.querySelectorAll('.lang-toggle-btn').forEach(button => {
				button.addEventListener('click', (e) => {
					e.preventDefault();
					const lang = button.getAttribute('data-lang');
					switchLanguage(lang);
				});
			});
		});
	})();
</script>

<style>
	.settings-slider {
		position: fixed;
		top: 0;
		right: 0;
		z-index: 1000;
		font-family: var(--nes-font, 'Press Start 2P', monospace);
	}

	/* Закладка (tab) - компактная, не длинная */
	.settings-tab {
		position: absolute;
		right: 0;
		top: 0;
		width: 36px;
		height: 36px;
		background: var(--nes-white);
		border: 3px solid var(--nes-black);
		border-right: none;
		border-top-left-radius: 0;
		border-bottom-left-radius: 0;
		display: flex;
		align-items: center;
		justify-content: center;
		cursor: pointer;
		box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
		transition: all 0.2s ease;
		color: var(--nes-black);
		z-index: 1001;
	}

	.settings-tab:hover {
		background: var(--nes-yellow);
		transform: translateX(-2px);
	}

	.settings-tab svg {
		width: 16px;
		height: 16px;
	}

	/* Выдвигающаяся панель - длинная узкая полоска */
	.settings-panel {
		position: absolute;
		right: 0;
		top: 0;
		width: 0;
		height: auto;
		background: var(--nes-white);
		border: 3px solid var(--nes-black);
		border-right: none;
		box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
		overflow: hidden;
		opacity: 0;
		transform: translateX(100%);
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		pointer-events: none;
		min-width: 50px;
	}

	.settings-slider:hover .settings-panel {
		width: 50px;
		opacity: 1;
		transform: translateX(0);
		pointer-events: all;
	}

	.settings-controls {
		padding: 8px 4px;
		display: flex;
		flex-direction: column;
		gap: 8px;
		align-items: center;
	}

	/* Тумблер темы (вертикальный) */
	.theme-toggle-wrapper {
		width: 100%;
		display: flex;
		justify-content: center;
	}

	.theme-toggle-btn {
		width: 36px;
		height: 36px;
		padding: 0;
		background: var(--nes-white);
		border: 3px solid var(--nes-black);
		border-radius: 0;
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		position: relative;
		transition: all 0.15s ease;
		color: var(--nes-black);
	}

	.theme-toggle-btn:hover {
		background: var(--nes-yellow);
		transform: translateY(-1px);
		box-shadow: 0 2px 0 var(--nes-black);
	}

	.theme-icon {
		position: absolute;
		top: 50%;
		left: 50%;
		width: 16px;
		height: 16px;
		pointer-events: none;
		transform: translate(-50%, -50%);
		transition: opacity 0.2s ease, visibility 0.2s ease;
	}

	.theme-icon-sun,
	.theme-icon-moon {
		opacity: 0;
		visibility: hidden;
		display: none;
	}

	/* Тумблер языков (вертикальный) */
	.language-toggle-wrapper {
		width: 100%;
		display: flex;
		flex-direction: column;
		gap: 0;
		border: 3px solid var(--nes-black);
	}

	.lang-toggle-btn {
		width: 100%;
		height: 32px;
		padding: 0;
		background: var(--nes-white);
		border: none;
		border-bottom: 2px solid var(--nes-black);
		border-radius: 0;
		color: var(--nes-black);
		font-size: 0.5rem;
		font-weight: 400;
		cursor: pointer;
		transition: all 0.15s ease;
		font-family: var(--nes-font, 'Press Start 2P', monospace);
		text-transform: uppercase;
		display: flex;
		align-items: center;
		justify-content: center;
		line-height: 1;
	}

	.lang-toggle-btn:last-child {
		border-bottom: none;
	}

	.lang-toggle-btn:hover {
		background: var(--nes-yellow);
		color: var(--nes-black);
		transform: translateY(-1px);
	}

	.lang-toggle-btn.active {
		background: var(--nes-blue);
		color: var(--nes-white);
		font-weight: 600;
		text-shadow: 1px 1px 0px var(--nes-black);
	}

	/* Мобильная адаптация */
	@media (max-width: 768px) {
		.settings-tab {
			width: 32px;
			height: 32px;
		}

		.settings-tab svg {
			width: 14px;
			height: 14px;
		}

		.settings-slider:hover .settings-panel {
			width: 44px;
		}

		.settings-panel {
			min-width: 44px;
		}

		.theme-toggle-btn {
			width: 32px;
			height: 32px;
		}

		.lang-toggle-btn {
			height: 28px;
			font-size: 0.45rem;
		}
	}
</style>
