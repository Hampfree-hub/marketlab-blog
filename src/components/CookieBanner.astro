---
// CookieBanner.astro - ������ �������������� � ����
// ��������� RU/EN/ES
---

<div class="cookie-banner" role="dialog" aria-labelledby="cookie-title" aria-describedby="cookie-description" id="cookie-banner" style="display: none;">
	<div class="cookie-banner-content">
		<div class="cookie-banner-text">
			<p id="cookie-title" class="cookie-banner-title" data-lang="ru">������ �������?</p>
			<p id="cookie-description" class="cookie-banner-description" data-lang="ru">
				�� �� �������, ������ �������� ���� ��� ���� ����������� � �������������� �����. 
				��� ��� ����������� ��������� � �������� �������� ������ ������� � ������� ��� ����� �������. 
				��������� ������������ ����, �� ������������ � ����� 
				<a href="/privacy" target="_blank" rel="noopener noreferrer">��������� ������������������</a>.
			</p>
			<p class="cookie-banner-title" data-lang="en" style="display: none;">Want a cookie?</p>
			<p class="cookie-banner-description" data-lang="en" style="display: none;">
				We're not spying, just collecting cookies to make the lab cozy and personalize your experience. 
				It's like a technical indicator � helps improve system performance and make your visit more convenient. 
				By continuing to use the site, you agree to our 
				<a href="/privacy" target="_blank" rel="noopener noreferrer">Privacy Policy</a>.
			</p>
			<p class="cookie-banner-title" data-lang="es" style="display: none;">?Quieres una galleta?</p>
			<p class="cookie-banner-description" data-lang="es" style="display: none;">
				No espiamos, solo recopilamos cookies para hacer el laboratorio acogedor y personalizar tu experiencia. 
				Es como un indicador tecnico: ayuda a mejorar el rendimiento del sistema y hacer tu visita mas conveniente. 
				Al continuar usando el sitio, acepta nuestra 
				<a href="/privacy" target="_blank" rel="noopener noreferrer">Politica de privacidad</a>.
			</p>
		</div>
		<div class="cookie-banner-buttons">
			<button 
				type="button" 
				class="cookie-banner-accept nes8bit-btn nes8bit-btn-success" 
				onclick="acceptCookies()"
				aria-label="������� ������������� ����"
			>
				<span data-lang="ru">�������</span>
				<span data-lang="en" style="display: none;">Accept</span>
				<span data-lang="es" style="display: none;">Aceptar</span>
			</button>
			<button 
				type="button" 
				class="cookie-banner-reject nes8bit-btn nes8bit-btn-danger" 
				onclick="rejectCookies()"
				aria-label="��������� ������������� ����"
			>
				<span data-lang="ru">���������</span>
				<span data-lang="en" style="display: none;">Reject</span>
				<span data-lang="es" style="display: none;">Rechazar</span>
			</button>
		</div>
	</div>
</div>

<style>
	.cookie-banner {
		position: fixed;
		bottom: 0;
		left: 0;
		right: 0;
		background: var(--nes-white);
		border-top: var(--nes-border-width, 2px) solid var(--nes-black);
		border-top-left-radius: 4px; /* ���������� ������� ���� */
		border-top-right-radius: 4px; /* ���������� ������� ���� */
		padding: 20px;
		/* ��� ����� - ������� �������� */
		z-index: 999; /* ���� CTA-�����, ����� �� ��� ����� */
		font-family: 'Arial', sans-serif;
		max-height: 180px; /* ������������ ������, ����� �� ����������� ������� */
		overflow-y: auto; /* ���������, ���� ������� �� ���������� */
	}

	.cookie-banner-content {
		max-width: 1200px;
		margin: 0 auto;
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 20px;
		flex-wrap: wrap;
	}

	.cookie-banner-text {
		flex: 1;
		min-width: 300px;
	}

	.cookie-banner-title {
		font-family: var(--nes-font);
		font-size: 0.9rem;
		color: var(--nes-black);
		margin: 0 0 8px 0;
		text-transform: uppercase;
		font-weight: bold;
	}

	.cookie-banner-description {
		font-size: 0.85rem;
		color: var(--nes-gray);
		margin: 0;
		line-height: 1.6;
	}

	.cookie-banner-description a {
		color: var(--nes-blue);
		text-decoration: underline;
	}

	.cookie-banner-description a:hover {
		color: var(--nes-red);
	}

	.cookie-banner-buttons {
		display: flex;
		gap: 10px;
		flex-wrap: wrap;
	}

	.cookie-banner-accept,
	.cookie-banner-reject {
		min-width: 120px;
		transition: all 0.15s ease;
		position: relative;
		border: var(--nes-border-width, 2px) solid var(--nes-black);
		/* ��� ����� - ������� ������ */
	}

	/* Hover - ����� ������ */
	.cookie-banner-accept:hover,
	.cookie-banner-reject:hover {
		background: var(--nes-yellow) !important; /* ��������������� hover - ����� ���� */
		color: var(--nes-black) !important;
		transform: translateY(-1px) !important; /* ���� �������� ����� */
		/* ��� ����� - ������� ������ */
	}

	/* Active - ���������� ���� */
	.cookie-banner-accept:active,
	.cookie-banner-reject:active {
		transform: translateY(1px) !important; /* ������ ����������� ���� */
		/* ��� ����� - ������� ������ */
		transition: transform 0.05s ease !important;
	}

	/* ��������� ��������� */
	@media (max-width: 768px) {
		.cookie-banner {
			padding: 15px;
		}

		.cookie-banner-content {
			flex-direction: column;
			align-items: stretch;
		}

		.cookie-banner-buttons {
			width: 100%;
		}

		.cookie-banner-accept,
		.cookie-banner-reject {
			flex: 1;
			min-width: 0;
		}
	}

	/* ТЁМНАЯ ТЕМА: CookieBanner */
	html.dark-theme .cookie-banner {
		background: var(--nes-bg-card, #1a2a1a);
		border-top-color: rgba(0, 255, 65, 0.3);
	}

	html.dark-theme .cookie-banner-title {
		color: var(--nes-neon-green, #00ff41);
	}

	html.dark-theme .cookie-banner-description {
		color: var(--nes-text-light, #e5e5e5);
	}

	html.dark-theme .cookie-banner-description a {
		color: var(--nes-neon-cyan, #00ffff);
	}

	html.dark-theme .cookie-banner-description a:hover {
		color: var(--nes-neon-green, #00ff41);
	}
</style>

<script>
	// ����������� ����� ��������
	function getPageLanguage() {
		const htmlLang = document.documentElement.lang || 'ru';
		return htmlLang.toLowerCase().split('-')[0]; // 'ru', 'en', 'es'
	}

	// ��������/������ �������� �� �����
	function updateLanguageVisibility(lang) {
		document.querySelectorAll('[data-lang]').forEach(el => {
			const elLang = el.getAttribute('data-lang');
			if (elLang === lang) {
				el.style.display = '';
			} else {
				el.style.display = 'none';
			}
		});
	}

	// ��������, ���� �� ��� ������� ������� � ����
	function checkCookieConsent() {
		const consent = localStorage.getItem('cookieConsent');
		if (consent === 'accepted' || consent === 'rejected') {
			return false; // �� ���������� ������
		}
		return true; // �������� ������
	}

	// ������� ����
	function acceptCookies() {
		// 1. ��������� ����� ������������ � localStorage
		localStorage.setItem('cookieConsent', 'accepted');
		
		// 2. ����� ����� �������� ������������� ��������� (Google Analytics, ������.������� � �.�.)
		// ��������:
		// if (typeof gtag !== 'undefined') {
		//   gtag('consent', 'update', { 'analytics_storage': 'granted' });
		// }
		
		// 3. �������� ������
		hideCookieBanner();
		
		console.log('Cookies accepted - ��������� ��������');
	}

	// ��������� ����
	function rejectCookies() {
		// 1. ��������� ����� ������������ � localStorage
		localStorage.setItem('cookieConsent', 'rejected');
		
		// 2. ��������� ��������� (���� ��� ���� ����������������)
		// ��������:
		// if (typeof gtag !== 'undefined') {
		//   gtag('consent', 'update', { 'analytics_storage': 'denied' });
		// }
		
		// 3. �������� ������
		hideCookieBanner();
		
		console.log('Cookies rejected - ��������� ���������');
	}
	
	// ������ ������
	function hideCookieBanner() {
		const banner = document.getElementById('cookie-banner');
		if (banner) {
			banner.style.display = 'none';
		}
	}

	// ������������ ������� � ���������� ������� ��������� ��� onclick
	// �����: ������ ��� ����� ����� ����������� �������, ����� ��� ���� �������� ��� �������� ��������
	if (typeof window !== 'undefined') {
		window.acceptCookies = acceptCookies;
		window.rejectCookies = rejectCookies;
		window.hideCookieBanner = hideCookieBanner;
	}

	// ������������� ��� �������� ��������
	if (typeof window !== 'undefined') {
		// ������������ ������� �� DOMContentLoaded, ����� ��� ���� �������� �����
		window.acceptCookies = acceptCookies;
		window.rejectCookies = rejectCookies;
		window.hideCookieBanner = hideCookieBanner;
		
		document.addEventListener('DOMContentLoaded', function() {
			const lang = getPageLanguage();
			updateLanguageVisibility(lang);

			if (checkCookieConsent()) {
				const banner = document.getElementById('cookie-banner');
				if (banner) {
					banner.style.display = 'block';
				}
			}
		});
	}
</script>




