---
// CookieBanner.astro - Баннер предупреждения о куки
// Поддержка RU/EN/ES
---

<div class="cookie-banner" role="dialog" aria-labelledby="cookie-title" aria-describedby="cookie-description" id="cookie-banner" style="display: none;">
	<div class="cookie-banner-content">
		<div class="cookie-banner-text">
			<p id="cookie-title" class="cookie-banner-title" data-lang="ru">Хотите печенье?</p>
			<p id="cookie-description" class="cookie-banner-description" data-lang="ru">
				Мы не шпионим, просто собираем куки для уюта лаборатории и персонализации опыта. 
				Это как технический индикатор — помогает улучшить работу системы и сделать ваш визит удобнее. 
				Продолжая использовать сайт, вы соглашаетесь с нашей 
				<a href="/privacy" target="_blank" rel="noopener noreferrer">Политикой конфиденциальности</a>.
			</p>
			<p class="cookie-banner-title" data-lang="en" style="display: none;">Want a cookie?</p>
			<p class="cookie-banner-description" data-lang="en" style="display: none;">
				We're not spying, just collecting cookies to make the lab cozy and personalize your experience. 
				It's like a technical indicator — helps improve system performance and make your visit more convenient. 
				By continuing to use the site, you agree to our 
				<a href="/privacy" target="_blank" rel="noopener noreferrer">Privacy Policy</a>.
			</p>
			<p class="cookie-banner-title" data-lang="es" style="display: none;">¿Quieres una galleta?</p>
			<p class="cookie-banner-description" data-lang="es" style="display: none;">
				No espiamos, solo recopilamos cookies para hacer el laboratorio acogedor y personalizar tu experiencia. 
				Es como un indicador técnico: ayuda a mejorar el rendimiento del sistema y hacer tu visita más conveniente. 
				Al continuar usando el sitio, acepta nuestra 
				<a href="/privacy" target="_blank" rel="noopener noreferrer">Política de privacidad</a>.
			</p>
		</div>
		<div class="cookie-banner-buttons">
			<button 
				type="button" 
				class="cookie-banner-accept nes8bit-btn nes8bit-btn-success" 
				onclick="acceptCookies()"
				aria-label="Принять использование куки"
			>
				<span data-lang="ru">Принять</span>
				<span data-lang="en" style="display: none;">Accept</span>
				<span data-lang="es" style="display: none;">Aceptar</span>
			</button>
			<button 
				type="button" 
				class="cookie-banner-reject nes8bit-btn nes8bit-btn-danger" 
				onclick="rejectCookies()"
				aria-label="Отклонить использование куки"
			>
				<span data-lang="ru">Отклонить</span>
				<span data-lang="en" style="display: none;">Reject</span>
				<span data-lang="es" style="display: none;">Rechazar</span>
			</button>
		</div>
	</div>
</div>

<style>
	.cookie-banner {
		position: fixed;
		bottom: 0;
		left: 0;
		right: 0;
		background: var(--nes-white);
		border-top: 3px solid var(--nes-black); /* Более лаконичная рамка */
		padding: 20px;
		box-shadow: 0 -4px 8px rgba(0, 0, 0, 0.3);
		z-index: 999; /* Ниже CTA-блока, чтобы он был виден */
		font-family: 'Arial', sans-serif;
		max-height: 180px; /* Ограничиваем высоту, чтобы не перекрывать контент */
		overflow-y: auto; /* Прокрутка, если контент не помещается */
	}

	.cookie-banner-content {
		max-width: 1200px;
		margin: 0 auto;
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 20px;
		flex-wrap: wrap;
	}

	.cookie-banner-text {
		flex: 1;
		min-width: 300px;
	}

	.cookie-banner-title {
		font-family: var(--nes-font);
		font-size: 0.9rem;
		color: var(--nes-black);
		margin: 0 0 8px 0;
		text-transform: uppercase;
		font-weight: bold;
	}

	.cookie-banner-description {
		font-size: 0.85rem;
		color: var(--nes-gray);
		margin: 0;
		line-height: 1.6;
	}

	.cookie-banner-description a {
		color: var(--nes-blue);
		text-decoration: underline;
	}

	.cookie-banner-description a:hover {
		color: var(--nes-red);
	}

	.cookie-banner-buttons {
		display: flex;
		gap: 10px;
		flex-wrap: wrap;
	}

	.cookie-banner-accept,
	.cookie-banner-reject {
		min-width: 120px;
		transition: transform 0.15s ease, box-shadow 0.15s ease, border-bottom-width 0.15s ease;
		position: relative;
		border-bottom-width: 2px !important; /* Нижняя граница стандартная (как у nav) */
	}

	/* Hover - лёгкий подъём */
	.cookie-banner-accept:hover,
	.cookie-banner-reject:hover {
		transform: translateY(-2px) !important;
		box-shadow: 0 4px 0 var(--nes-black) !important; /* Стандартная тень при hover (как у nav) */
	}

	/* Active - прожимание вниз, нижняя полоса остаётся на месте */
	.cookie-banner-accept:active,
	.cookie-banner-reject:active {
		transform: translateY(1px) !important; /* Кнопка прожимается вниз (как у nav) */
		box-shadow: 0 1px 0 var(--nes-black) !important; /* Нижняя тень остаётся на месте! */
		border-bottom-width: 2px !important; /* Сохраняем нижнюю границу */
		transition: transform 0.05s ease, box-shadow 0.05s ease, border-bottom-width 0.05s ease !important;
	}

	/* Мобильная адаптация */
	@media (max-width: 768px) {
		.cookie-banner {
			padding: 15px;
		}

		.cookie-banner-content {
			flex-direction: column;
			align-items: stretch;
		}

		.cookie-banner-buttons {
			width: 100%;
		}

		.cookie-banner-accept,
		.cookie-banner-reject {
			flex: 1;
			min-width: 0;
		}
	}
</style>

<script>
	// Определение языка страницы
	function getPageLanguage() {
		const htmlLang = document.documentElement.lang || 'ru';
		return htmlLang.toLowerCase().split('-')[0]; // 'ru', 'en', 'es'
	}

	// Показать/скрыть элементы по языку
	function updateLanguageVisibility(lang) {
		document.querySelectorAll('[data-lang]').forEach(el => {
			const elLang = el.getAttribute('data-lang');
			if (elLang === lang) {
				el.style.display = '';
			} else {
				el.style.display = 'none';
			}
		});
	}

	// Проверка, было ли уже принято решение о куки
	function checkCookieConsent() {
		const consent = localStorage.getItem('cookieConsent');
		if (consent === 'accepted' || consent === 'rejected') {
			return false; // Не показывать баннер
		}
		return true; // Показать баннер
	}

	// Принять куки
	function acceptCookies() {
		// 1. Сохраняем выбор пользователя в localStorage
		localStorage.setItem('cookieConsent', 'accepted');
		
		// 2. Здесь можно добавить инициализацию аналитики (Google Analytics, Яндекс.Метрика и т.д.)
		// Например:
		// if (typeof gtag !== 'undefined') {
		//   gtag('consent', 'update', { 'analytics_storage': 'granted' });
		// }
		
		// 3. Скрываем баннер
		hideCookieBanner();
		
		console.log('Cookies accepted - аналитика включена');
	}

	// Отклонить куки
	function rejectCookies() {
		// 1. Сохраняем выбор пользователя в localStorage
		localStorage.setItem('cookieConsent', 'rejected');
		
		// 2. Отключаем аналитику (если она была инициализирована)
		// Например:
		// if (typeof gtag !== 'undefined') {
		//   gtag('consent', 'update', { 'analytics_storage': 'denied' });
		// }
		
		// 3. Скрываем баннер
		hideCookieBanner();
		
		console.log('Cookies rejected - аналитика отключена');
	}
	
	// Скрыть баннер
	function hideCookieBanner() {
		const banner = document.getElementById('cookie-banner');
		if (banner) {
			banner.style.display = 'none';
		}
	}

	// Экспортируем функции в глобальную область видимости для onclick
	// ВАЖНО: Делаем это сразу после определения функций, чтобы они были доступны при загрузке страницы
	if (typeof window !== 'undefined') {
		window.acceptCookies = acceptCookies;
		window.rejectCookies = rejectCookies;
		window.hideCookieBanner = hideCookieBanner;
	}

	// Инициализация при загрузке страницы
	if (typeof window !== 'undefined') {
		// Экспортируем функции ДО DOMContentLoaded, чтобы они были доступны сразу
		window.acceptCookies = acceptCookies;
		window.rejectCookies = rejectCookies;
		window.hideCookieBanner = hideCookieBanner;
		
		document.addEventListener('DOMContentLoaded', function() {
			const lang = getPageLanguage();
			updateLanguageVisibility(lang);

			if (checkCookieConsent()) {
				const banner = document.getElementById('cookie-banner');
				if (banner) {
					banner.style.display = 'block';
				}
			}
		});
	}
</script>




