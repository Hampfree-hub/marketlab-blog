---
// Компонент переключения темы (светлая/тёмная)
---

<button id="theme-toggle" class="theme-toggle" aria-label="Переключить тему" title="Переключить тему">
	<svg class="theme-icon theme-icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
		<circle cx="12" cy="12" r="5"></circle>
		<line x1="12" y1="1" x2="12" y2="3"></line>
		<line x1="12" y1="21" x2="12" y2="23"></line>
		<line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
		<line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
		<line x1="1" y1="12" x2="3" y2="12"></line>
		<line x1="21" y1="12" x2="23" y2="12"></line>
		<line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
		<line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
	</svg>
	<svg class="theme-icon theme-icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
		<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
	</svg>
</button>

<script>
	(function() {
		const themeToggle = document.getElementById('theme-toggle');
		const html = document.documentElement;
		
		// Проверка на null
		if (!themeToggle) return;
		
		// Получаем сохранённую тему или системную
		function getInitialTheme(): 'dark' | 'light' {
			const saved = localStorage.getItem('theme');
			if (saved === 'dark' || saved === 'light') {
				return saved;
			}
			// Проверяем системную тему
			return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
		}
		
		// Применяем тему
		function setTheme(theme: 'dark' | 'light') {
			if (theme === 'dark') {
				html.classList.add('dark-theme');
				html.classList.remove('light-theme');
			} else {
				html.classList.add('light-theme');
				html.classList.remove('dark-theme');
			}
			localStorage.setItem('theme', theme);
		}
		
		// Инициализация
		const currentTheme = getInitialTheme();
		setTheme(currentTheme);
		
		// Принудительно обновляем видимость иконок после применения темы
		function updateIcons() {
			if (!themeToggle) return;
			
			const isDark = html.classList.contains('dark-theme');
			const sunIcon = themeToggle.querySelector('.theme-icon-sun') as SVGElement | null;
			const moonIcon = themeToggle.querySelector('.theme-icon-moon') as SVGElement | null;
			
			if (isDark) {
				// Тёмная тема - показываем солнце (чтобы переключить на светлую)
				if (sunIcon && sunIcon instanceof SVGElement) {
					sunIcon.style.setProperty('opacity', '1', 'important');
					sunIcon.style.setProperty('visibility', 'visible', 'important');
					sunIcon.style.setProperty('display', 'block', 'important');
					sunIcon.style.setProperty('transform', 'translate(-50%, -50%) rotate(0deg) scale(1)', 'important');
				}
				if (moonIcon && moonIcon instanceof SVGElement) {
					moonIcon.style.setProperty('opacity', '0', 'important');
					moonIcon.style.setProperty('visibility', 'hidden', 'important');
					moonIcon.style.setProperty('display', 'none', 'important');
				}
			} else {
				// Светлая тема - показываем луну (чтобы переключить на тёмную)
				if (sunIcon && sunIcon instanceof SVGElement) {
					sunIcon.style.setProperty('opacity', '0', 'important');
					sunIcon.style.setProperty('visibility', 'hidden', 'important');
					sunIcon.style.setProperty('display', 'none', 'important');
				}
				if (moonIcon && moonIcon instanceof SVGElement) {
					moonIcon.style.setProperty('opacity', '1', 'important');
					moonIcon.style.setProperty('visibility', 'visible', 'important');
					moonIcon.style.setProperty('display', 'block', 'important');
					moonIcon.style.setProperty('transform', 'translate(-50%, -50%) rotate(0deg) scale(1)', 'important');
				}
			}
		}
		
		// Обновляем иконки после инициализации (двойной вызов для надёжности)
		setTimeout(updateIcons, 0);
		setTimeout(updateIcons, 50);
		
		// Переключение темы
		if (themeToggle) {
			themeToggle.addEventListener('click', () => {
				const isDark = html.classList.contains('dark-theme');
				setTheme(isDark ? 'light' : 'dark');
				// Обновляем иконки после переключения
				setTimeout(updateIcons, 10);
			});
		}
		
		// Слушаем изменения системной темы (только если нет сохранённой)
		window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
			if (!localStorage.getItem('theme')) {
				setTheme(e.matches ? 'dark' : 'light');
				setTimeout(updateIcons, 10);
			}
		});
	})();
</script>

<style>
	.theme-toggle {
		width: 32px;
		height: 32px;
		min-width: 32px;
		min-height: 32px;
		padding: 0;
		background: transparent;
		border: 1px solid rgba(122, 122, 122, 0.3);
		border-radius: 50%;
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		position: relative;
		transition: all var(--transition-smooth, 0.4s cubic-bezier(0.4, 0, 0.2, 1));
		color: var(--text-primary);
		line-height: 1;
		box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
	}
	
	.theme-toggle:hover {
		background: var(--bg-secondary);
		border-color: var(--green-primary, var(--accent));
		color: var(--green-primary, var(--accent));
		transform: translateY(-1px) scale(1.05);
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
	}
	
	.theme-icon {
		position: absolute;
		top: 50%;
		left: 50%;
		width: 18px;
		height: 18px;
		pointer-events: none;
		transition: opacity var(--transition-smooth, 0.4s cubic-bezier(0.4, 0, 0.2, 1)), 
		            transform var(--transition-smooth, 0.4s cubic-bezier(0.4, 0, 0.2, 1)),
		            visibility var(--transition-smooth, 0.4s cubic-bezier(0.4, 0, 0.2, 1));
		transform: translate(-50%, -50%);
	}
	
	/* Начальное состояние - скрываем обе иконки по умолчанию */
	.theme-icon-sun,
	.theme-icon-moon {
		opacity: 0;
		visibility: hidden;
		display: none;
	}
	
	@media (max-width: 600px) {
		.theme-toggle {
			width: 30px;
			height: 30px;
			min-width: 30px;
			min-height: 30px;
		}
		
		.theme-icon {
			width: 15px;
			height: 15px;
		}
	}
</style>

